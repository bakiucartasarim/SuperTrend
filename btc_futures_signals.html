<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC Futures - Canlƒ± SuperTrend Sinyalleri</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 0;
            text-align: center;
            border-bottom: 2px solid #333;
        }

        .header h1 {
            color: #f7931a;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #ccc;
            font-size: 1.1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .price-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .current-price {
            font-size: 2rem;
            font-weight: bold;
            color: #f7931a;
        }

        .price-change {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .price-change.positive {
            color: #4CAF50;
        }

        .price-change.negative {
            color: #f44336;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid #333;
            position: relative;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            width: 100%;
            margin-bottom: 20px;
        }

        .signals-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid #333;
        }

        .panel-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #f7931a;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }

        .signal-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #333;
            transition: all 0.3s ease;
        }

        .signal-card.buy {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .signal-card.sell {
            border-left-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }

        .signal-card.strong-buy {
            border-left-color: #00E676;
            background: rgba(0, 230, 118, 0.15);
            box-shadow: 0 0 10px rgba(0, 230, 118, 0.3);
        }

        .signal-card.strong-sell {
            border-left-color: #FF1744;
            background: rgba(255, 23, 68, 0.15);
            box-shadow: 0 0 10px rgba(255, 23, 68, 0.3);
        }

        .signal-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .signal-type {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .signal-time {
            font-size: 0.9rem;
            color: #ccc;
        }

        .signal-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9rem;
        }

        .supertrend-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .supertrend-table th,
        .supertrend-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #333;
        }

        .supertrend-table th {
            background: rgba(247, 147, 26, 0.2);
            color: #f7931a;
            font-weight: bold;
        }

        .supertrend-table td {
            background: rgba(255, 255, 255, 0.05);
        }

        .trend-bullish {
            color: #4CAF50;
            font-weight: bold;
        }

        .trend-bearish {
            color: #f44336;
            font-weight: bold;
        }

        .chart-placeholder {
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 1.2rem;
            border: 2px dashed #333;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            border-top: 1px solid #333;
        }

        #priceChart {
            display: block;
            box-sizing: border-box;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .price-info {
                flex-direction: column;
                text-align: center;
            }
            
            .chart-wrapper {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚Çø BTC Futures Signals</h1>
        <p>Canlƒ± SuperTrend 1H & 15M Sinyal Sistemi</p>
    </div>

    <div class="container">
        <div class="status-bar">
            <div class="price-info">
                <div class="current-price" id="currentPrice">$0.00</div>
                <div class="price-change" id="priceChange">+0.00%</div>
            </div>
            <div class="connection-status">
                <div class="status-dot"></div>
                <span>Canlƒ± Veri</span>
            </div>
        </div>

        <div class="main-content">
            <div class="chart-container">
                <div class="panel-title">üìà BTC/USDT 1 Dakika Grafik</div>
                <div class="chart-wrapper">
                    <canvas id="priceChart"></canvas>
                </div>
                
                <table class="supertrend-table">
                    <thead>
                        <tr>
                            <th>Timeframe</th>
                            <th>Trend</th>
                            <th>ST Price</th>
                            <th>Signal</th>
                            <th>Son Cross</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1H</td>
                            <td class="trend-1h" id="trend1h">-</td>
                            <td id="st1h">$0.00</td>
                            <td id="signal1h">-</td>
                            <td id="cross1h">-</td>
                        </tr>
                        <tr>
                            <td>15M</td>
                            <td class="trend-15m" id="trend15m">-</td>
                            <td id="st15m">$0.00</td>
                            <td id="signal15m">-</td>
                            <td id="cross15m">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="signals-panel">
                <div class="panel-title">üö® Aktif Sinyaller</div>
                <div id="signalsContainer">
                    <div class="signal-card">
                        <div class="signal-header">
                            <div class="signal-type">Sistem Ba≈ülatƒ±lƒ±yor...</div>
                        </div>
                        <div class="signal-details">
                            <div>Veri bekleniyor</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>‚ö†Ô∏è Bu sinyaller yalnƒ±zca bilgilendirme ama√ßlƒ±dƒ±r. Yatƒ±rƒ±m kararlarƒ±nƒ±zƒ± kendi sorumluluƒüunuzda alƒ±n.</p>
    </div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

    <script>
        // SuperTrend hesaplama fonksiyonlarƒ±
        class SuperTrendCalculator {
            constructor(period = 10, multiplier = 3.0) {
                this.period = period;
                this.multiplier = multiplier;
                this.data = [];
            }

            calculateATR(highs, lows, closes) {
                const trs = [];
                for (let i = 1; i < highs.length; i++) {
                    const tr1 = highs[i] - lows[i];
                    const tr2 = Math.abs(highs[i] - closes[i-1]);
                    const tr3 = Math.abs(lows[i] - closes[i-1]);
                    trs.push(Math.max(tr1, tr2, tr3));
                }
                return this.sma(trs, this.period);
            }

            sma(values, period) {
                const result = [];
                for (let i = period - 1; i < values.length; i++) {
                    const sum = values.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);
                    result.push(sum / period);
                }
                return result;
            }

            calculate(highs, lows, closes) {
                const hl2 = highs.map((h, i) => (h + lows[i]) / 2);
                const atr = this.calculateATR(highs, lows, closes);
                
                const upperBand = [];
                const lowerBand = [];
                const supertrend = [];
                const direction = [];

                for (let i = 0; i < hl2.length - this.period + 1; i++) {
                    const atrValue = atr[i] || atr[atr.length - 1];
                    upperBand.push(hl2[i + this.period - 1] + (this.multiplier * atrValue));
                    lowerBand.push(hl2[i + this.period - 1] - (this.multiplier * atrValue));
                }

                // SuperTrend hesaplama logic'i
                for (let i = 0; i < upperBand.length; i++) {
                    if (i === 0) {
                        supertrend.push(lowerBand[i]);
                        direction.push(1);
                        continue;
                    }

                    const close = closes[i + this.period - 1];
                    const prevClose = closes[i + this.period - 2];
                    const prevSupertrend = supertrend[i - 1];
                    const prevDirection = direction[i - 1];

                    let currentSupertrend, currentDirection;

                    if (prevDirection === 1) {
                        currentSupertrend = close > prevSupertrend ? upperBand[i] : prevSupertrend;
                        currentDirection = close < currentSupertrend ? -1 : 1;
                    } else {
                        currentSupertrend = close < prevSupertrend ? lowerBand[i] : prevSupertrend;
                        currentDirection = close > currentSupertrend ? 1 : -1;
                    }

                    supertrend.push(currentSupertrend);
                    direction.push(currentDirection);
                }

                return { supertrend, direction };
            }
        }

        // Global deƒüi≈ükenler
        let ws = null;
        let priceData = {
            '1m': [],
            '15m': [],
            '1h': []
        };
        let superTrend1h = new SuperTrendCalculator(10, 3.0);
        let superTrend15m = new SuperTrendCalculator(10, 3.0);
        let lastSignals = { '1h': null, '15m': null };
        let priceChart = null;

        // WebSocket baƒülantƒ±sƒ±
        function connectWebSocket() {
            try {
                ws = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@kline_1m');
                
                ws.onopen = function(event) {
                    console.log('WebSocket baƒülantƒ±sƒ± a√ßƒ±ldƒ±');
                    updateConnectionStatus(true);
                };

                ws.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    processBinanceData(data);
                };

                ws.onclose = function(event) {
                    console.log('WebSocket baƒülantƒ±sƒ± kapandƒ±');
                    updateConnectionStatus(false);
                    // 5 saniye sonra yeniden baƒülanmayƒ± dene
                    setTimeout(connectWebSocket, 5000);
                };

                ws.onerror = function(error) {
                    console.error('WebSocket hatasƒ±:', error);
                    updateConnectionStatus(false);
                };
            } catch (error) {
                console.error('WebSocket baƒülantƒ± hatasƒ±:', error);
                updateConnectionStatus(false);
            }
        }

        // Binance verisini i≈üle
        function processBinanceData(data) {
            if (data.k) {
                const kline = data.k;
                const price = parseFloat(kline.c);
                const high = parseFloat(kline.h);
                const low = parseFloat(kline.l);
                const open = parseFloat(kline.o);
                
                updateCurrentPrice(price, open);
                
                // 1 dakikalƒ±k veriyi ekle
                if (kline.x) { // Kapalƒ± mum
                    addPriceData('1m', { high, low, close: price, open, time: kline.t });
                    calculateSignals();
                    updateChart();
                }
            }
        }

        // Fiyat verisi ekle
        function addPriceData(timeframe, data) {
            if (!priceData[timeframe]) {
                priceData[timeframe] = [];
            }
            
            priceData[timeframe].push(data);
            
            // Son 1000 veriyi sakla
            if (priceData[timeframe].length > 1000) {
                priceData[timeframe] = priceData[timeframe].slice(-1000);
            }
        }

        // Ge√ßmi≈ü verileri y√ºkle
        async function loadHistoricalData() {
            try {
                const intervals = ['1m', '15m', '1h'];
                const promises = intervals.map(interval => 
                    fetch(`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${interval}&limit=200`)
                        .then(response => response.json())
                );

                const results = await Promise.all(promises);
                
                intervals.forEach((interval, index) => {
                    const klines = results[index];
                    priceData[interval] = klines.map(k => ({
                        time: k[0],
                        open: parseFloat(k[1]),
                        high: parseFloat(k[2]),
                        low: parseFloat(k[3]),
                        close: parseFloat(k[4])
                    }));
                });

                calculateSignals();
                updateChart();
            } catch (error) {
                console.error('Ge√ßmi≈ü veri y√ºkleme hatasƒ±:', error);
            }
        }

        // Sinyalleri hesapla
        function calculateSignals() {
            if (priceData['1h'].length < 50 || priceData['15m'].length < 50) {
                return;
            }

            // 1H SuperTrend
            const data1h = priceData['1h'];
            const highs1h = data1h.map(d => d.high);
            const lows1h = data1h.map(d => d.low);
            const closes1h = data1h.map(d => d.close);
            
            const st1h = superTrend1h.calculate(highs1h, lows1h, closes1h);
            
            // 15M SuperTrend
            const data15m = priceData['15m'];
            const highs15m = data15m.map(d => d.high);
            const lows15m = data15m.map(d => d.low);
            const closes15m = data15m.map(d => d.close);
            
            const st15m = superTrend15m.calculate(highs15m, lows15m, closes15m);

            updateSuperTrendTable(st1h, st15m);
            checkForSignals(st1h, st15m);
        }

        // Sinyal kontrol√º
        function checkForSignals(st1h, st15m) {
            const currentDirection1h = st1h.direction[st1h.direction.length - 1];
            const prevDirection1h = st1h.direction[st1h.direction.length - 2];
            
            const currentDirection15m = st15m.direction[st15m.direction.length - 1];
            const prevDirection15m = st15m.direction[st15m.direction.length - 2];

            // Trend deƒüi≈üimi kontrol√º
            if (currentDirection15m !== prevDirection15m) {
                const signalType = currentDirection15m === 1 ? 'sell' : 'buy';
                addSignal(signalType, '15m', 'normal');
            }

            if (currentDirection1h !== prevDirection1h) {
                const signalType = currentDirection1h === 1 ? 'sell' : 'buy';
                addSignal(signalType, '1h', 'normal');
            }

            // G√º√ßl√º sinyal kontrol√º (her iki timeframe aynƒ± y√∂nde)
            const bothBullish = currentDirection1h === -1 && currentDirection15m === -1;
            const bothBearish = currentDirection1h === 1 && currentDirection15m === 1;
            
            const prevBothBullish = prevDirection1h === -1 && prevDirection15m === -1;
            const prevBothBearish = prevDirection1h === 1 && prevDirection15m === 1;

            if (bothBullish && !prevBothBullish) {
                addSignal('buy', 'both', 'strong');
            } else if (bothBearish && !prevBothBearish) {
                addSignal('sell', 'both', 'strong');
            }
        }

        // Sinyal ekle
        function addSignal(type, timeframe, strength) {
            const container = document.getElementById('signalsContainer');
            const signalCard = document.createElement('div');
            
            let className = 'signal-card ';
            let signalText = '';
            let emoji = '';
            
            if (strength === 'strong') {
                className += type === 'buy' ? 'strong-buy' : 'strong-sell';
                signalText = type === 'buy' ? 'G√ú√áL√ú ALIM' : 'G√ú√áL√ú SATIM';
                emoji = type === 'buy' ? 'üöÄ' : 'üí•';
            } else {
                className += type;
                signalText = type === 'buy' ? 'ALIM' : 'SATIM';
                emoji = type === 'buy' ? 'üìà' : 'üìâ';
            }
            
            signalCard.className = className;
            signalCard.innerHTML = `
                <div class="signal-header">
                    <div class="signal-type">${emoji} ${signalText} - ${timeframe.toUpperCase()}</div>
                    <div class="signal-time">${new Date().toLocaleTimeString('tr-TR')}</div>
                </div>
                <div class="signal-details">
                    <div>Timeframe: ${timeframe === 'both' ? '1H + 15M' : timeframe}</div>
                    <div>Tip: ${strength === 'strong' ? 'G√º√ßl√º' : 'Normal'}</div>
                </div>
            `;
            
            // En √ºste ekle
            container.insertBefore(signalCard, container.firstChild);
            
            // En fazla 10 sinyal g√∂ster
            while (container.children.length > 10) {
                container.removeChild(container.lastChild);
            }
        }

        // SuperTrend tablosunu g√ºncelle
        function updateSuperTrendTable(st1h, st15m) {
            if (st1h.direction.length === 0 || st15m.direction.length === 0) return;

            const trend1h = st1h.direction[st1h.direction.length - 1] === 1 ? 'BEARISH' : 'BULLISH';
            const trend15m = st15m.direction[st15m.direction.length - 1] === 1 ? 'BEARISH' : 'BULLISH';
            
            document.getElementById('trend1h').textContent = trend1h;
            document.getElementById('trend1h').className = trend1h === 'BULLISH' ? 'trend-bullish' : 'trend-bearish';
            
            document.getElementById('trend15m').textContent = trend15m;
            document.getElementById('trend15m').className = trend15m === 'BULLISH' ? 'trend-bullish' : 'trend-bearish';
            
            document.getElementById('st1h').textContent = '$' + st1h.supertrend[st1h.supertrend.length - 1].toFixed(2);
            document.getElementById('st15m').textContent = '$' + st15m.supertrend[st15m.supertrend.length - 1].toFixed(2);
            
            // Sinyal hesapla
            const signal1h = trend1h === 'BULLISH' ? 'üü¢ ALIM' : 'üî¥ SATIM';
            const signal15m = trend15m === 'BULLISH' ? 'üü¢ ALIM' : 'üî¥ SATIM';
            
            document.getElementById('signal1h').textContent = signal1h;
            document.getElementById('signal15m').textContent = signal15m;
        }

        // Mevcut fiyatƒ± g√ºncelle
        function updateCurrentPrice(price, openPrice) {
            const change = ((price - openPrice) / openPrice) * 100;
            
            document.getElementById('currentPrice').textContent = '$' + price.toFixed(2);
            
            const changeElement = document.getElementById('priceChange');
            changeElement.textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
            changeElement.className = 'price-change ' + (change >= 0 ? 'positive' : 'negative');
        }

        // Baƒülantƒ± durumunu g√ºncelle
        function updateConnectionStatus(isConnected) {
            const dot = document.querySelector('.status-dot');
            if (isConnected) {
                dot.style.background = '#4CAF50';
            } else {
                dot.style.background = '#f44336';
            }
        }

        // Grafik ba≈ülat
        function initChart() {
            const canvas = document.getElementById('priceChart');
            const ctx = canvas.getContext('2d');
            
            // Canvas boyutlarƒ±nƒ± ayarla
            canvas.style.width = '100%';
            canvas.style.height = '400px';
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'BTC Price',
                        data: [],
                        borderColor: '#f7931a',
                        backgroundColor: 'rgba(247, 147, 26, 0.1)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.1
                    }, {
                        label: '1H SuperTrend',
                        data: [],
                        borderColor: '#4CAF50',
                        backgroundColor: 'transparent',
                        borderWidth: 3,
                        fill: false,
                        pointRadius: 0
                    }, {
                        label: '15M SuperTrend',
                        data: [],
                        borderColor: '#2196F3',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    layout: {
                        padding: {
                            top: 10,
                            bottom: 10,
                            left: 10,
                            right: 10
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'minute',
                                displayFormats: {
                                    minute: 'HH:mm'
                                }
                            },
                            ticks: {
                                color: '#ffffff',
                                maxTicksLimit: 10
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // Grafiƒüi g√ºncelle
        function updateChart() {
            if (!priceChart || priceData['1m'].length === 0) return;

            const last50Data = priceData['1m'].slice(-50);
            const labels = last50Data.map(d => new Date(d.time));
            const prices = last50Data.map(d => d.close);

            priceChart.data.labels = labels;
            priceChart.data.datasets[0].data = prices;

            // SuperTrend verilerini ekle
            if (priceData['1h'].length > 10) {
                const st1h = superTrend1h.calculate(
                    priceData['1h'].map(d => d.high),
                    priceData['1h'].map(d => d.low),
                    priceData['1h'].map(d => d.close)
                );
                if (st1h.supertrend.length > 0) {
                    priceChart.data.datasets[1].data = Array(prices.length).fill(st1h.supertrend[st1h.supertrend.length - 1]);
                }
            }

            if (priceData['15m'].length > 10) {
                const st15m = superTrend15m.calculate(
                    priceData['15m'].map(d => d.high),
                    priceData['15m'].map(d => d.low),
                    priceData['15m'].map(d => d.close)
                );
                if (st15m.supertrend.length > 0) {
                    priceChart.data.datasets[2].data = Array(prices.length).fill(st15m.supertrend[st15m.supertrend.length - 1]);
                }
            }

            priceChart.update('none');
        }

        // Sayfa y√ºklendiƒüinde ba≈ülat
        window.addEventListener('load', function() {
            initChart();
            loadHistoricalData().then(() => {
                connectWebSocket();
            });
        });

        // Sayfa kapanƒ±rken baƒülantƒ±yƒ± kapat
        window.addEventListener('beforeunload', function() {
            if (ws) {
                ws.close();
            }
        });
    </script>
</body>
</html>
